<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mocking in Jest with TypeScript and React.</title>
    <meta name="description" content="It is functions all the way down.">
    <link rel="shortcut icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="stylesheet" href="/static/prism.css">
  </head>
  <body>
    <header>
      <h1 class="home">
        <a href="/">Rupert &#39;fildon&#39; McKay</a>
      </h1>
    </header>
    <article>
  <h2>Mocking in Jest with TypeScript and React.</h2>
  <p>Key takeaways:</p>
<ul>
<li><code>jest.mock</code> covers many use cases</li>
<li><code>jest.MockedFunction&lt;typeof YourFunction&gt;</code> is the best for type-safe mock functions</li>
<li>Don't be afraid to mock React components <em>they are just functions!</em></li>
</ul>
<h2>Getting started with mocking</h2>
<p>Let's suppose we have a simple <code>User</code> component that displays the user's name, or &quot;Guest&quot; if no user was found:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> getUserDetails <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./user-storage"</span><span class="token punctuation">;</span><br><br><span class="token keyword">interface</span> <span class="token class-name">UserProps</span> <span class="token punctuation">{</span><br>  userId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">User</span><span class="token punctuation">(</span><span class="token punctuation">{</span> userId <span class="token punctuation">}</span><span class="token operator">:</span> UserProps<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">JSX</span><span class="token punctuation">.</span>Element <span class="token punctuation">{</span><br>  <span class="token comment">// Get information about the user from some external resource</span><br>  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token function">getUserDetails</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Use the user's name, or "Guest" if no user was found</span><br>  <span class="token keyword">const</span> displayName <span class="token operator">=</span> user <span class="token operator">?</span> user<span class="token punctuation">.</span>name <span class="token operator">:</span> <span class="token string">"Guest"</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">return</span> <span class="token punctuation">(</span><br>    <span class="token operator">&lt;</span>section<span class="token operator">></span><br>      <span class="token operator">&lt;</span>h2<span class="token operator">></span><span class="token punctuation">{</span>displayName<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span><br>    <span class="token operator">&lt;</span><span class="token operator">/</span>section<span class="token operator">></span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<h2>Attempt #1</h2>
<p>Here's what a first attempt at testing this component might look like:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> render<span class="token punctuation">,</span> screen <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@testing-library/react"</span><span class="token punctuation">;</span><br><br><span class="token keyword">import</span> <span class="token punctuation">{</span> User <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./user"</span><span class="token punctuation">;</span><br><br><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">"User component"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"displays the user's name"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token comment">// Render the component with some dummy user ID</span><br>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>User userId<span class="token operator">=</span><span class="token string">"1234"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Expect the component to have rendered the user's name</span><br>    <span class="token function">expect</span><span class="token punctuation">(</span>screen<span class="token punctuation">.</span><span class="token function">getByText</span><span class="token punctuation">(</span><span class="token string">"rupert"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeInTheDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Unfortunately, when we run this it doesn't work! We tried to render our <code>User</code> component, by passing it a user ID <code>1234</code>, which gets passed to <code>getUserDetails</code>, and then we expected our component to render the name <code>rupert</code>. The problem is that maybe <code>getUserDetails</code> depends on a database or some network calls, which we don't have available while running our tests. Whatever <code>getUserDetails</code> needs to work... <em>this test shouldn't care about that</em>. So let's mock it!</p>
<p>The quickest and easiest way to do that is with <a href="https://jestjs.io/docs/jest-object#jestmockmodulename-factory-options">jest.mock</a>:</p>
<h2>Using Jest module factory</h2>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> render<span class="token punctuation">,</span> screen <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@testing-library/react"</span><span class="token punctuation">;</span><br><br><span class="token keyword">import</span> <span class="token punctuation">{</span> User <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./user"</span><span class="token punctuation">;</span><br><br>jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">"./user-storage"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token comment">// Mock implementation that just always returns "rupert"</span><br>  <span class="token function-variable function">getUserDetails</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"rupert"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">"User component"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"displays the user's name"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>User userId<span class="token operator">=</span><span class="token string">"1234"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token function">expect</span><span class="token punctuation">(</span>screen<span class="token punctuation">.</span><span class="token function">getByText</span><span class="token punctuation">(</span><span class="token string">"rupert"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeInTheDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>The first argument to <code>jest.mock</code> is the path to the module you want to mock, and the second is your custom implementation of that module which will replace the &quot;real&quot; thing during the tests in this file.</p>
<p>This works! But there are some weaknesses here.</p>
<p>Before I go on, I want to make 100% clear that the above snippet may well be sufficient in <em>very many cases</em>. What follows after this point is only necessary if you want even more confidence in your tests.</p>
<p>The first weakness to point out is that despite being in TypeScript, we don't actually have any type guarantee on our mocked implementation. If for example I had a typo in the mock implementation:</p>
<pre class="language-ts"><code class="language-ts">jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">"./user-storage"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token comment">// O no my finger slipped and I pressed "a" too many times</span><br>  <span class="token function-variable function">getUserDetails</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> naaaaaaaame<span class="token operator">:</span> <span class="token string">"rupert"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>TypeScript doesn't know that this is an invalid implementation of <code>getUserDetails</code> <em>even though</em> the real <code>getUserDetails</code> is strictly typed. TypeScript is not able to check that for us, because, inside the <code>jest.mock</code> call, TypeScript can't tell what &quot;real&quot; module we are talking about. As far as TypeScript is concerned the first argument to <code>jest.mock</code> <em>is just a string</em> and the second argument <em>is just some anonymous function</em>. It has no reason to believe they should match up with any &quot;real&quot; types it already knows about.</p>
<p>There are some ways to give it a hint though:</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// Import a reference to the "real" function</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> getUserDetails <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./user-storage"</span><span class="token punctuation">;</span><br><br><span class="token comment">// Declare that our mock implementation must return a valid "getUserDetails" implementation</span><br>jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">"./user-storage"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">{</span> getUserDetails<span class="token operator">:</span> <span class="token keyword">typeof</span> getUserDetails <span class="token punctuation">}</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token comment">// TypeScript will now correctly tell us this doesn't match the expected type</span><br>  <span class="token class-name">getUserDetails</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> naaaaaaaame<span class="token operator">:</span> <span class="token string">"rupert"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>But I really don't like that, the syntax is clunky and for larger modules, gets unwieldy very quickly. We can streamline it a bit like so:</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// This time we import the whole module namespace</span><br><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> UserStorage <span class="token keyword">from</span> <span class="token string">"./user-storage"</span><span class="token punctuation">;</span><br><br><span class="token comment">// And use the 'typeof' that namespace to enforce our mock matches</span><br>jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">"./user-storage"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">typeof</span> UserStorage <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token comment">// Correctly tells us this doesn't match the expected type</span><br>  <span class="token class-name">getUserDetails</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> naaaaaaaame<span class="token operator">:</span> <span class="token string">"rupert"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>This also works. But I'm still not in love with it. Having to import the whole namespace just to mock a single function is over the top. I liked it when we could import just the one thing we wanted to mock. But how can we do that while still getting strict type checking on our mock implementations?</p>
<p>The trick here is actually to take a step back from Jest module factories, and instead, let Jest handle more of the mocking automatically for us:</p>
<pre class="language-ts"><code class="language-ts">jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">"./user-storage"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>That's it! No factory! If you don't provide a second argument to <code>jest.mock</code>, Jest will inspect the module at that path and automatically mock out all exported members with mocks that do nothing. Depending on your situation that might be enough. But we know in our example we do need <code>getUserDetails</code> to return some realistic data. So how can we get the best of both automatically mocking the whole module, while also providing custom behavior to one specific exported member? To do this we will need to retain a reference to the exported member we care about so that we can manipulate it in some way:</p>
<h2>Keeping a reference to our mocks</h2>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> render<span class="token punctuation">,</span> screen <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@testing-library/react"</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> User <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./user"</span><span class="token punctuation">;</span><br><br><span class="token comment">// This module will be mocked, but we grab a reference for later</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> getUserDetails <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./user-storage"</span><span class="token punctuation">;</span><br><br><span class="token comment">// Let Jest do its automocking magic</span><br>jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">"./user-storage"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">"User component"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token comment">// Let TypeScript know that this thing is a mock</span><br>  <span class="token keyword">const</span> mockGetUserDetails <span class="token operator">=</span> getUserDetails <span class="token keyword">as</span> jest<span class="token punctuation">.</span>MockedFunction<span class="token operator">&lt;</span><br>    <span class="token keyword">typeof</span> getUserDetails<br>  <span class="token operator">></span><span class="token punctuation">;</span><br>  <span class="token comment">// Provide our custom implementation here</span><br>  mockGetUserDetails<span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"rupert"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"displays the user's name"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>User userId<span class="token operator">=</span><span class="token string">"1234"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token function">expect</span><span class="token punctuation">(</span>screen<span class="token punctuation">.</span><span class="token function">getByText</span><span class="token punctuation">(</span><span class="token string">"rupert"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeInTheDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>This might look a little funky at first. It looks like we are assigning the &quot;real&quot; <code>getUserDetails</code> to some fake <code>mockGetUserDetails</code>... but we also cast it with an <code>as</code> using <a href="https://jestjs.io/docs/mock-function-api#jestmockedfunction">jest.MockedFunction</a>... is that correct? Yes! And it gets at an important little quirk of the way Jest and TypeScript interact.</p>
<p>Jest modifies mocked modules <em>at runtime</em>, it does so in a way that leaves the mocked module compatible with its original type but wraps everything to provide mock utility methods such as <code>mockImplementation</code>. But TypeScript doesn't &quot;see&quot; that this has happened, so we have to help it out. If we didn't do this <code>as</code> assignment then TypeScript would forbid us from calling <code>mockImplementation</code> on <code>getUserDetails</code>, because for all TypeScript knows <code>getUserDetails</code> doesn't have a <code>mockImplementation</code> method. But we know that Jest added that while mocking the module. So this line is necessary just to get TypeScript to understand that Jest has modified the module in some way.</p>
<p>This might seem like a lot of work just to get to the same point we had with our first jest module factory approach, but it now opens up a lot of new interesting possibilities.</p>
<p>For instance we can now assert that the mock was called:</p>
<pre class="language-ts"><code class="language-ts"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"displays the user's name"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>User userId<span class="token operator">=</span><span class="token string">"1234"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Confirm that the mock was called with the correct arguments</span><br>  <span class="token function">expect</span><span class="token punctuation">(</span>mockGetUserDetails<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">"1234"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">expect</span><span class="token punctuation">(</span>screen<span class="token punctuation">.</span><span class="token function">getByText</span><span class="token punctuation">(</span><span class="token string">"rupert"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeInTheDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>We can also change the behaviour of the mock on the fly:</p>
<pre class="language-ts"><code class="language-ts"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"displays the user's name"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>User userId<span class="token operator">=</span><span class="token string">"1234"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// We can add an expectation here that the mock was called with the correct arguments</span><br>  <span class="token function">expect</span><span class="token punctuation">(</span>mockGetUserDetails<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">"1234"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">expect</span><span class="token punctuation">(</span>screen<span class="token punctuation">.</span><span class="token function">getByText</span><span class="token punctuation">(</span><span class="token string">"rupert"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeInTheDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Change the mock implementation to simulate no user found</span><br>  mockGetUserDetails<span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>User userId<span class="token operator">=</span><span class="token string">"1234"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Expect the new behaviour to be reflected in what our component renders</span><br>  <span class="token function">expect</span><span class="token punctuation">(</span>screen<span class="token punctuation">.</span><span class="token function">getByText</span><span class="token punctuation">(</span><span class="token string">"Guest"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeInTheDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>A big thing to watch out for when doing this though is that mock implementations persist between unit tests in the same file. If a test changes the behavior of a mock, tests that run afterward will get that new behavior. This is rarely what we want since our tests should be completely isolated and independent. To enforce that principle we can set up a mock implementation in a <code>beforeEach</code> block:</p>
<pre class="language-ts"><code class="language-ts"><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  mockGetUserDetails<span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span><br>    name<span class="token operator">:</span> <span class="token string">"rupert"</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"displays the user's name"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>User userId<span class="token operator">=</span><span class="token string">"1234"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Correctly works with the default mock implementation</span><br>  <span class="token function">expect</span><span class="token punctuation">(</span>screen<span class="token punctuation">.</span><span class="token function">getByText</span><span class="token punctuation">(</span><span class="token string">"rupert"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeInTheDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"displays 'Guest' if the user is not found"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token comment">// Simulate no user being found</span><br>  mockGetUserDetails<span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>User userId<span class="token operator">=</span><span class="token string">"1234"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Works with the one-off implementation provided just above</span><br>  <span class="token function">expect</span><span class="token punctuation">(</span>screen<span class="token punctuation">.</span><span class="token function">getByText</span><span class="token punctuation">(</span><span class="token string">"Guest"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeInTheDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Now whatever order our tests run in, they all start with the same mock implementation provided.</p>
<p>I really like this pattern when many tests can rely on a sensible &quot;happy path&quot; default, while just a few tests can try out specific edge cases, without affecting any other tests.</p>
<p>One other thing we really need to watch out for here though is making sure we clear our mocks between tests. If in the above example we added a third test:</p>
<pre class="language-ts"><code class="language-ts"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"something is fishy here"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token function">expect</span><span class="token punctuation">(</span>mockGetUserDetails<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">"1234"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>That test will pass! But how? It doesn't do anything, yet somehow it is still true that the mock was called with that argument. Well, just like mock implementations persist through the whole test file, so too does the mock's &quot;memory&quot; of when it has been called. To prevent this confusing behavior, we should clear the &quot;memory&quot; of mocks between tests:</p>
<pre class="language-ts"><code class="language-ts"><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  jest<span class="token punctuation">.</span><span class="token function">clearAllMocks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>This is such a regular thing to need to do in every test file that Jest provides a config option to just always do it everywhere <a href="https://jestjs.io/docs/configuration#clearmocks-boolean">clearMocks</a>. This option defaults to 'false' but if you find yourself writing <code>jest.clearAllMocks()</code> in a lot of files, you might want to try turning that option on.</p>
<p>Before moving on to the next section, here is a full copy of our test file so far, featuring a type-safe mock, we can assert against whilst also configuring different behaviors per test:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> render<span class="token punctuation">,</span> screen <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@testing-library/react"</span><span class="token punctuation">;</span><br><br><span class="token keyword">import</span> <span class="token punctuation">{</span> getUserDetails <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./user-storage"</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> User <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./user"</span><span class="token punctuation">;</span><br><br>jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">"./user-storage"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">"User component"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> mockGetUserDetails <span class="token operator">=</span> getUserDetails <span class="token keyword">as</span> jest<span class="token punctuation">.</span>MockedFunction<span class="token operator">&lt;</span><br>    <span class="token keyword">typeof</span> getUserDetails<br>  <span class="token operator">></span><span class="token punctuation">;</span><br><br>  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    jest<span class="token punctuation">.</span><span class="token function">clearAllMocks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    mockGetUserDetails<span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"rupert"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"displays the user's name"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>User userId<span class="token operator">=</span><span class="token string">"1234"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token function">expect</span><span class="token punctuation">(</span>mockGetUserDetails<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">"1234"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">expect</span><span class="token punctuation">(</span>screen<span class="token punctuation">.</span><span class="token function">getByText</span><span class="token punctuation">(</span><span class="token string">"rupert"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeInTheDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"displays 'Guest' if the user is not found"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    mockGetUserDetails<span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>User userId<span class="token operator">=</span><span class="token string">"1234"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token function">expect</span><span class="token punctuation">(</span>mockGetUserDetails<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">"1234"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">expect</span><span class="token punctuation">(</span>screen<span class="token punctuation">.</span><span class="token function">getByText</span><span class="token punctuation">(</span><span class="token string">"Guest"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeInTheDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2>Mocking a React Component</h2>
<p>Now let's pretend our <code>User</code> component also depends on some third party widget component:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> getUserDetails <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./user-storage"</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> ThirdPartyWidget <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"third-party-library"</span><span class="token punctuation">;</span><br><br><span class="token keyword">interface</span> <span class="token class-name">UserProps</span> <span class="token punctuation">{</span><br>  userId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">User</span><span class="token punctuation">(</span><span class="token punctuation">{</span> userId <span class="token punctuation">}</span><span class="token operator">:</span> UserProps<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">JSX</span><span class="token punctuation">.</span>Element <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token function">getUserDetails</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> displayName <span class="token operator">=</span> user <span class="token operator">?</span> user<span class="token punctuation">.</span>name <span class="token operator">:</span> <span class="token string">"Guest"</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token punctuation">(</span><br>    <span class="token operator">&lt;</span>section<span class="token operator">></span><br>      <span class="token operator">&lt;</span>h2<span class="token operator">></span><span class="token punctuation">{</span>displayName<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span><br>      <span class="token operator">&lt;</span>ThirdPartyWidget userId<span class="token operator">=</span><span class="token punctuation">{</span>userId<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><br>    <span class="token operator">&lt;</span><span class="token operator">/</span>section<span class="token operator">></span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>As before let's assume that we don't actually want to run this dependency during our tests. So how can we mock it? React components are just functions, and we can mock them just like any other function, just like we have done already in this post:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> ThirdPartyWidget <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"third-party-library"</span><span class="token punctuation">;</span><br><br>jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">"third-party-library"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">"User copmonent"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> mockThirdPartyWidget <span class="token operator">=</span> ThirdPartyWidget <span class="token keyword">as</span> jest<span class="token punctuation">.</span>MockedFunction<span class="token operator">&lt;</span><br>    <span class="token keyword">typeof</span> ThirdPartyWidget<br>  <span class="token operator">></span><span class="token punctuation">;</span><br>  <span class="token comment">// Mock this component to just always render an empty fragment</span><br>  mockThirdPartyWidget<span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">&lt;</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>This works <em>exactly</em> the same way as before. In this case, we just choose to mock the component by returning an empty fragment which is the shortest way to satisfy a <code>JSX.Element</code> return type.</p>
<p>There is one slight quirk with this though. We can assert that the <code>mockThirdPartyWidget</code> has been called like so:</p>
<pre class="language-ts"><code class="language-ts"><span class="token function">expect</span><span class="token punctuation">(</span>mockThirdPartyWidget<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>But if we want to assert exactly what arguments it was called with it gets a little fiddly. You might think the following would work:</p>
<pre class="language-ts"><code class="language-ts"><span class="token function">expect</span><span class="token punctuation">(</span>mockThirdPartyWidget<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token punctuation">{</span> userId<span class="token operator">:</span> <span class="token string">"1234"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>But what we find in practice is that it was called with two arguments: <code>{ userId: &quot;1234&quot; }, {}</code>. This is due to the way that <code>React.createElement</code> invokes custom components under the hood. The empty object corresponds to any React contexts that are available to this element. Since we know we aren't using any React context in this test we can simply add this empty object to our expectation:</p>
<pre class="language-ts"><code class="language-ts"><span class="token function">expect</span><span class="token punctuation">(</span>mockThirdPartyWidget<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token punctuation">{</span> userId<span class="token operator">:</span> <span class="token string">"1234"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>But when we inevitably do want to test a component rendered within a context, I find the following compromise acceptable:</p>
<pre class="language-ts"><code class="language-ts"><span class="token function">expect</span><span class="token punctuation">(</span>mockThirdPartyWidget<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><br>  <span class="token punctuation">{</span> userId<span class="token operator">:</span> <span class="token string">"1234"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  expect<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// Ignore React contexts</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>So finally our test file is now:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> render<span class="token punctuation">,</span> screen <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@testing-library/react"</span><span class="token punctuation">;</span><br><br><span class="token keyword">import</span> <span class="token punctuation">{</span> getUserDetails <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./user-storage"</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> ThirdPartyWidget <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"third-party-widget"</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> User <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./user"</span><span class="token punctuation">;</span><br><br>jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">"./user-storage"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">"third-party-widget"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">"User component"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> mockGetUserDetails <span class="token operator">=</span> getUserDetails <span class="token keyword">as</span> jest<span class="token punctuation">.</span>MockedFunction<span class="token operator">&lt;</span><br>    <span class="token keyword">typeof</span> getUserDetails<br>  <span class="token operator">></span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> mockThirdPartyWidget <span class="token operator">=</span> ThirdPartyWidget <span class="token keyword">as</span> jest<span class="token punctuation">.</span>MockedFunction<span class="token operator">&lt;</span><br>    <span class="token keyword">typeof</span> ThirdPartyWidget<br>  <span class="token operator">></span><span class="token punctuation">;</span><br><br>  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    jest<span class="token punctuation">.</span><span class="token function">clearAllMocks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    mockGetUserDetails<span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"rupert"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    mockThirdPartyWidget<span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">&lt;</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"displays the user's name"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>User userId<span class="token operator">=</span><span class="token string">"1234"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token function">expect</span><span class="token punctuation">(</span>mockGetUserDetails<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">"1234"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">expect</span><span class="token punctuation">(</span>screen<span class="token punctuation">.</span><span class="token function">getByText</span><span class="token punctuation">(</span><span class="token string">"rupert"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeInTheDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"displays 'Guest' if the user is not found"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    mockGetUserDetails<span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>User userId<span class="token operator">=</span><span class="token string">"1234"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token function">expect</span><span class="token punctuation">(</span>mockGetUserDetails<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">"1234"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">expect</span><span class="token punctuation">(</span>screen<span class="token punctuation">.</span><span class="token function">getByText</span><span class="token punctuation">(</span><span class="token string">"Guest"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeInTheDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"mounts the third party widget"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>User userId<span class="token operator">=</span><span class="token string">"1234"</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token function">expect</span><span class="token punctuation">(</span>mockThirdPartyWidget<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><br>      <span class="token punctuation">{</span> userId<span class="token operator">:</span> <span class="token string">"1234"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>      expect<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>And there you have it. Flexible yet type-safe mocks that work for any function <em>including</em> React components.</p>
<p>Summary:</p>
<ul>
<li><code>jest.mock</code> covers many use cases</li>
<li><code>jest.MockedFunction&lt;typeof YourFunction&gt;</code> is the best for type-safe mock functions</li>
<li>Don't be afraid to mock React components <em>they are just functions!</em></li>
</ul>
<p>Take care,</p>
<p>Rupert</p>
<hr>
<p>Library versions used when writing this post:</p>
<table>
<thead>
<tr>
<th>Dependency</th>
<th>Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>jest</code></td>
<td>27.0.6</td>
</tr>
<tr>
<td><code>react</code></td>
<td>17.0.2</td>
</tr>
<tr>
<td><code>typescript</code></td>
<td>4.3.5</td>
</tr>
<tr>
<td><code>@testing-library/react</code></td>
<td>12.0.0</td>
</tr>
</tbody>
</table>

</article>
  </body>
</html>