<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>React Testing Library Recipes.</title>
		<meta name="description" content="Common testing patterns for creating confidence in your UI tests.">
		<link rel="shortcut icon" type="image/x-icon" href="/static/favicon.ico">
		<link rel="stylesheet" href="/static/styles.css">
		<link rel="stylesheet" href="/static/prism.css">
		<meta
			property="og:description"
			content="Common testing patterns for creating confidence in your UI tests."
		/>
		<meta
			property="og:image"
			content="https://raw.githubusercontent.com/fildon/train-ride/main/train-ride.png"
		/>
		<meta property="og:image:type" content="image/png" />
		<meta property="og:image:width" content="1280" />
		<meta property="og:image:height" content="640" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta property="twitter:domain" content="rupertmckay.com" />
		<meta property="twitter:url" content="https://rupertmckay.com" />
		<meta name="twitter:title" content="React Testing Library Recipes." />
		<meta
			name="twitter:description"
			content="Common testing patterns for creating confidence in your UI tests."
		/>
		<meta
			name="twitter:image"
			content="https://raw.githubusercontent.com/fildon/train-ride/main/train-ride.png"
		/>
	</head>
	<body>
		<header class="horizontal-spread">
			<img
				src="../../static/headshot.jpeg"
				alt="Headshot of Rupert"
				class="rounded wonky"
				height="64"
				width="64"
			/>
			<h1><a href="/">Rupert McKay</a></h1>
		</header>
		<section class="full-width banner">
			<div>
				<h2>About</h2>
				<p>
					I am Rupert Foggo McKay. I live and work in the Netherlands.
					I work at <a href="https://odido.nl/">Odido.nl</a> as a Principal Software Engineer.
					I write blog posts on esoteric topics from time to time.
				</p>
			</div>
			<address>
				<a href="/blog/">Blog</a>
				<a href="https://github.com/fildon/">GitHub</a>
				<a rel="me" href="https://strangeobject.space/@fildon">Masto</a>
				<a href="mailto:rupert@rupertmckay.com">Email</a>
				<a href="./feed.xml">RSS</a>
			</address>
		</section>
		<article>
	<h1>React Testing Library Recipes.</h1>
	<span>Posted: <date datetime="Sat Dec 04 2021 00:00:00 GMT+0000 (Coordinated Universal Time)">04 Dec 2021</date></span>
	<p>As long as I've been working in frontend development, the tools available for testing UIs have felt clunky, hard to use, and not filled me with confidence that they reflect real end-user experiences.</p>
<p>I was especially tired of libraries that directly leaned on DOM queries or imperatively fired DOM events. This felt much too much like testing implementation details to me. But when I first saw Testing Library I knew it was different. Its documentation starts with this fantastic sentiment:</p>
<blockquote>
<p><a href="https://testing-library.com/docs/guiding-principles">The more your tests resemble the way your software is used, the more confidence they can give you.</a></p>
</blockquote>
<p>Testing Library approaches UI testing with a user-first attitude. Expectations are declared in terms of what is rendered <em>to the user</em> and interactivity is simulated only in ways <em>that a real user could do</em>.</p>
<p>I've been using Testing Library for about two years now and I've found myself developing a handful of testing recipes that I use over and over again. I'd like to present them to you now because I think they will help you in getting the most out of your UI tests.</p>
<h2 id="recipes" tabindex="-1"><a class="direct-link" href="#recipes" aria-hidden="true">#</a> Recipes</h2>
<p>All of the below recipes are included in a repository over here: <a href="https://github.com/fildon/react-testing-library-recipes">React Testing Library Recipes</a>. Feel free to clone the repo and run the tests for yourself to try them out locally.</p>
<h3 id="1-basic-recipe" tabindex="-1"><a class="direct-link" href="#1-basic-recipe" aria-hidden="true">#</a> 1 - Basic Recipe</h3>
<p>Let's start with something very basic. The classic counter component:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">Counter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>	<span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	<span class="token keyword">const</span> <span class="token function-variable function">incrementCount</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">=></span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	<span class="token keyword">return</span> <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>incrementCount<span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>To test this we would like to know what is presented to the user and also what interactivity is available to the user:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span><br><br><span class="token keyword">import</span> userEvent <span class="token keyword">from</span> <span class="token string">"@testing-library/user-event"</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> render<span class="token punctuation">,</span> screen <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@testing-library/react"</span><span class="token punctuation">;</span><br><br><span class="token keyword">import</span> <span class="token punctuation">{</span> Counter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./counter"</span><span class="token punctuation">;</span><br><br><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"displays initial count and increments when clicked"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>	<span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Counter <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	<span class="token function">expect</span><span class="token punctuation">(</span>screen<span class="token punctuation">.</span><span class="token function">getByRole</span><span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"0"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeInTheDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	userEvent<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span>screen<span class="token punctuation">.</span><span class="token function">getByText</span><span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	<span class="token function">expect</span><span class="token punctuation">(</span>screen<span class="token punctuation">.</span><span class="token function">getByRole</span><span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"1"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeInTheDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>In this test, we confirm that the <code>Counter</code> component initially renders a &quot;0&quot; but after it has been clicked then displays a &quot;1&quot;.</p>
<p>We could have also used <code>getByText</code> queries, but I like the additional implied check of <code>getByRole</code> since this helps our tests to confirm the accessibility of our components. Testing Library docs have a great guidance page on which queries you should prefer: <a href="https://testing-library.com/docs/queries/about#priority">Query priorities</a>.</p>
<p>Note also that in this test we simulate user interaction with the <code>userEvent</code> library. We could also have used <code>fireEvent</code> from <code>@testing-library/react</code>, but Testing Library recommends preferring the <code>userEvent</code> library. You can see this at the top of the page here: <a href="https://testing-library.com/docs/dom-testing-library/api-events">Firing Events</a>.</p>
<h3 id="2-negative-recipe" tabindex="-1"><a class="direct-link" href="#2-negative-recipe" aria-hidden="true">#</a> 2 - Negative Recipe</h3>
<p>Sometimes we want to confirm that something <em>was not rendered</em>. Suppose we have a welcome banner that displays a different message depending on whether the user is logged in or not:</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// user is null if not currently logged in</span><br><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">WelcomeHeading</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> user <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> user<span class="token operator">:</span> User <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>	<span class="token keyword">const</span> message <span class="token operator">=</span><br>		user <span class="token operator">===</span> <span class="token keyword">null</span><br>			<span class="token operator">?</span> <span class="token string">"Welcome Guest, would you like to log in?"</span><br>			<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Welcome </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, good to have you back!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><br>	<span class="token keyword">return</span> <span class="token operator">&lt;</span>h2<span class="token operator">></span><span class="token punctuation">{</span>message<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>Then we can test that we get the message that we expected and also that the other message was not displayed.</p>
<pre class="language-ts"><code class="language-ts"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"displays personalized message if the user is logged in"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>	<span class="token keyword">const</span> mockUser <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"Rupert"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>	<span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>WelcomeHeading user<span class="token operator">=</span><span class="token punctuation">{</span>mockUser<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	<span class="token function">expect</span><span class="token punctuation">(</span><br>		screen<span class="token punctuation">.</span><span class="token function">queryByRole</span><span class="token punctuation">(</span><span class="token string">"heading"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>			name<span class="token operator">:</span> <span class="token string">"Welcome Guest, would you like to login?"</span><span class="token punctuation">,</span><br>		<span class="token punctuation">}</span><span class="token punctuation">)</span><br>	<span class="token punctuation">)</span><span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">toBeInTheDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token function">expect</span><span class="token punctuation">(</span><br>		screen<span class="token punctuation">.</span><span class="token function">getByRole</span><span class="token punctuation">(</span><span class="token string">"heading"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>			name<span class="token operator">:</span> <span class="token string">"Welcome Rupert, good to have you back!"</span><span class="token punctuation">,</span><br>		<span class="token punctuation">}</span><span class="token punctuation">)</span><br>	<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeInTheDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Notice that we have to use the <code>queryByRole</code> method here. This is because all the <code>getBy*</code> queries immediately throw an error if they cannot find any matching element. Which would immediately fail our unit test. Instead <code>queryBy*</code> queries return <code>null</code> if no match is found. This works perfectly in combination with <code>.not.toBeInTheDocument()</code>.</p>
<p>You might also find this recipe useful to test that a modal was closed or that a notification can be dismissed.</p>
<h3 id="3-async-recipe" tabindex="-1"><a class="direct-link" href="#3-async-recipe" aria-hidden="true">#</a> 3 - Async Recipe</h3>
<p>Finally, let's look at how to handle a component with some asynchronous behavior. The following component makes a call to some API on mount. It initially displays a loading message, but once the API promise resolves it can display the information it received.</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span><br><br><span class="token keyword">import</span> <span class="token punctuation">{</span> fetchTemperatureFromApi <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./temperatureApi"</span><span class="token punctuation">;</span><br><br><span class="token keyword">type</span> <span class="token class-name">LoadingState</span> <span class="token operator">=</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">"loading"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">type</span> <span class="token class-name">ErrorState</span> <span class="token operator">=</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">"error"</span><span class="token punctuation">;</span> errorMessage<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">type</span> <span class="token class-name">SuccessState</span> <span class="token operator">=</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">"success"</span><span class="token punctuation">;</span> temperature<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">type</span> <span class="token class-name">ComponentState</span> <span class="token operator">=</span> LoadingState <span class="token operator">|</span> ErrorState <span class="token operator">|</span> SuccessState<span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">CurrentTemperature</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>	<span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span>ComponentState<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>		type<span class="token operator">:</span> <span class="token string">"loading"</span><span class="token punctuation">,</span><br>	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	React<span class="token punctuation">.</span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>		<span class="token function">fetchTemperatureFromApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>			<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>temperature<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">"success"</span><span class="token punctuation">,</span> temperature <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>			<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=></span><br>				<span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">"error"</span><span class="token punctuation">,</span> errorMessage<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><br>			<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	<span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">"error"</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">&lt;</span>span<span class="token operator">></span><span class="token punctuation">{</span>state<span class="token punctuation">.</span>errorMessage<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">;</span><br>	<span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">"loading"</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">&lt;</span>span<span class="token operator">></span><span class="token constant">LOADING</span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">;</span><br><br>	<span class="token keyword">return</span> <span class="token operator">&lt;</span>span<span class="token operator">></span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Today's temperature is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>state<span class="token punctuation">.</span>temperature<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>For this test suite, we first want to mock out the API dependency so that we can simulate different situations.</p>
<blockquote>
<p>I've written about mocking in Jest before, so if you'd like a little refresher you can read <a href="https://rupertmckay.com/blog/mocking-in-jest-with-typescript-and-react">Mocking in Jest with TypeScript and React</a>. I'll be following the mocking strategy described in that post.</p>
</blockquote>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> render<span class="token punctuation">,</span> screen <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@testing-library/react"</span><span class="token punctuation">;</span><br><br><span class="token keyword">import</span> <span class="token punctuation">{</span> CurrentTemperature <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./temperature"</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> fetchTemperatureFromApi <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./temperatureApi"</span><span class="token punctuation">;</span><br><br>jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">"./temperatureApi"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span><br>	fetchTemperatureFromApi<span class="token operator">:</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> mockFetchTemperatureFromApi <span class="token operator">=</span><br>	fetchTemperatureFromApi <span class="token keyword">as</span> jest<span class="token punctuation">.</span>MockedFunction<span class="token operator">&lt;</span><br>		<span class="token keyword">typeof</span> fetchTemperatureFromApi<br>	<span class="token operator">></span><span class="token punctuation">;</span><br><br><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>	jest<span class="token punctuation">.</span><span class="token function">clearAllMocks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"displays current temperature when API resolves"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>	<span class="token comment">// Simulate an API call taking half a second to resolve</span><br>	mockFetchTemperatureFromApi<span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><br>		<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">res</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>	<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	<span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>CurrentTemperature <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	<span class="token function">expect</span><span class="token punctuation">(</span>screen<span class="token punctuation">.</span><span class="token function">getByText</span><span class="token punctuation">(</span><span class="token string">"LOADING..."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeInTheDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	<span class="token function">expect</span><span class="token punctuation">(</span><br>		<span class="token keyword">await</span> screen<span class="token punctuation">.</span><span class="token function">findByText</span><span class="token punctuation">(</span><span class="token string">"Today's temperature is 20"</span><span class="token punctuation">)</span><br>	<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeInTheDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"displays error message in case of API failure"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>	<span class="token comment">// Simulate an API call failing</span><br>	mockFetchTemperatureFromApi<span class="token punctuation">.</span><span class="token function">mockRejectedValue</span><span class="token punctuation">(</span><span class="token string">"mock error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	<span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>CurrentTemperature <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	<span class="token function">expect</span><span class="token punctuation">(</span>screen<span class="token punctuation">.</span><span class="token function">getByText</span><span class="token punctuation">(</span><span class="token string">"LOADING..."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeInTheDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	<span class="token function">expect</span><span class="token punctuation">(</span><span class="token keyword">await</span> screen<span class="token punctuation">.</span><span class="token function">findByText</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">mock error</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeInTheDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>In this test suite, we simulate two different cases, one in which the API rejects with a failure and another in which it resolves successfully, but only after some time. In both cases, we can verify that the loading message is immediately displayed, but to confirm what happens next, we need to wait for the component to rerender once the API call has resolved (successfully or not). To do that we use a <code>findBy</code> query which returns a promise that resolves when a match is found. By default, it reattempts finding a match every 50ms but times out after 1000ms. Both of these numbers are configurable, however.</p>
<h2 id="conclusions" tabindex="-1"><a class="direct-link" href="#conclusions" aria-hidden="true">#</a> Conclusions</h2>
<ul>
<li><code>getBy*</code> verifies that something is rendered.</li>
<li><code>queryBy*</code> can be used to verify that something is <em>not</em> rendered.</li>
<li><code>findyBy*</code> verifies that something is <em>eventually</em> rendered.</li>
<li>Prefer <code>*ByRole</code> wherever possible to encourage the use of semantic HTML and better accessibility.</li>
<li>Use the companion library <a href="https://github.com/testing-library/user-event">testing-library/user-event</a> to simulate realistic user actions.</li>
</ul>
<p>The three examples above might not seem like much, but these recipes cover 99% of the cases I find in my work. Leave a comment below if these recipes are useful to you, or if you think you have a common use case not addressed by any of these.</p>
<p>Take care,
Rupert</p>

</article>
		<pre aria-hidden="true" class="morse">
█ ███ █
███ ███
</pre>
	</body>
</html>