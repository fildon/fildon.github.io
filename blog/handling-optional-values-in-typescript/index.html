<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Handling Optional Values in TypeScript.</title>
		<meta name="description" content="What are all these question marks in my code?">
		<link rel="shortcut icon" type="image/x-icon" href="/static/favicon.ico">
		<link rel="stylesheet" href="/static/styles.css">
		<link rel="stylesheet" href="/static/prism.css">
		<meta
			property="og:image"
			content="https://raw.githubusercontent.com/fildon/train-ride/main/train-ride.png"
		/>
		<meta property="og:image:type" content="image/png" />
		<meta property="og:image:width" content="1280" />
		<meta property="og:image:height" content="640" />
	</head>
	<body>
		<header class="horizontal-spread">
			<img
				src="../../static/headshot.jpeg"
				alt="Headshot of Rupert"
				class="rounded wonky"
				height="64"
				width="64"
			/>
			<h1><a href="../../.">Rupert 'fildon' McKay</a></h1>
		</header>
		<pre aria-hidden="true" class="morse">
█ ███ █
███ ███
</pre>
		<article>
	<h1>Handling Optional Values in TypeScript.</h1>
	<span>Posted: <date datetime="Sat Jul 10 2021 00:00:00 GMT+0000 (Coordinated Universal Time)">10 Jul 2021</date></span>
	<p>Key takeaways:</p>
<ul>
<li>Prefer <code>??</code> to <code>||</code></li>
<li>Prefer <code>foo?.bar</code> to <code>foo &amp;&amp; foo.bar</code></li>
</ul>
<p>In this post, we'll dive into three separate but similar syntaxes related to values that might not be defined:</p>
<ul>
<li>Optional Properties (?:)</li>
<li>Nullish Coalescing Operator (??)</li>
<li>Optional Chaining (?.)</li>
</ul>
<h2 id="optional-properties" tabindex="-1"><a class="direct-link" href="#optional-properties" aria-hidden="true">#</a> Optional Properties (?:)</h2>
<p><a href="https://www.typescriptlang.org/docs/handbook/2/objects.html#optional-properties">TypeScript Docs: Optional Properties</a></p>
<p>TypeScript supports optional properties via the following syntax:</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// Works with 'interface'</span><br><span class="token keyword">interface</span> <span class="token class-name">User</span> <span class="token punctuation">{</span><br>  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span><br>  age<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// and also with 'type'</span><br><span class="token keyword">type</span> <span class="token class-name">User</span> <span class="token operator">=</span> <span class="token punctuation">{</span><br>  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span><br>  age<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>This defines a <code>User</code>, having a <code>name</code> and <code>age</code>. But whereas <code>name</code> is required, <code>age</code> is optional:</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// Ash Ketchum is ten years old</span><br><span class="token keyword">const</span> ash<span class="token operator">:</span> User <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"Ash Ketchum"</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token comment">// But Rupert doesn't want to tell you his age and that's OK</span><br><span class="token keyword">const</span> rupert<span class="token operator">:</span> User <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"Rupert McKay"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>When defining a function that accepts the <code>User</code> type, the <code>age</code> type will be <code>number | undefined</code>:</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// Lets find out if this user is old enough to drive</span><br><span class="token keyword">function</span> <span class="token function">isOldEnoughToDrive</span><span class="token punctuation">(</span>user<span class="token operator">:</span> User<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// initially user.age is number | undefined</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span>age <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// But after an if check the type will be narrowed</span><br>    <span class="token comment">// In this example we return 'false' if 'age' isn't available.</span><br>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token comment">// But if age is available, then it is narrowed to a 'number' type.</span><br>  <span class="token keyword">return</span> user<span class="token punctuation">.</span>age <span class="token operator">>=</span> <span class="token constant">DRIVING_AGE</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token function">isOldEnoughToDrive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"Ash Ketchum"</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns false</span><br><span class="token function">isOldEnoughToDrive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"Rupert McKay"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns false</span><br><span class="token function">isOldEnoughToDrive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"Bilbo Baggins"</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">111</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// returns true</span></code></pre>
<p>This behavior is <em>nearly</em> equivalent to if we had:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">User</span> <span class="token punctuation">{</span><br>  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span><br>  age<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>The difference is whether the key must be explicitly provided by objects wanting to satisfy this interface:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">User</span> <span class="token punctuation">{</span><br>  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span><br>  age<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// Type error! "age" is a required property of "User"</span><br><span class="token keyword">const</span> rupert<span class="token operator">:</span> User <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"Rupert McKay"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token comment">// This works... but I really don't like seeing explicit "undefined"</span><br><span class="token keyword">const</span> rupert<span class="token operator">:</span> User <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">"Rupert McKay"</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token keyword">undefined</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>The Optional Property syntax defines properties we can omit. Whatever type we provide will default to <code>undefined</code> if the key is omitted.</p>
<h2 id="nullish-coalescing-operator" tabindex="-1"><a class="direct-link" href="#nullish-coalescing-operator" aria-hidden="true">#</a> Nullish Coalescing Operator (??)</h2>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Nullish_coalescing_operator">MDN: Nullish coalescing operator</a></p>
<p>The <code>Nullish Coalescing Operator</code> provides a default value in case our original value is undefined or null.</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> postTitle <span class="token operator">=</span> post<span class="token punctuation">.</span>title <span class="token operator">??</span> <span class="token string">"Rupert's blog post"</span><span class="token punctuation">;</span></code></pre>
<p>This will look familiar to JavaScript programmers who are used to using the OR operator (<code>||</code>) to provide default values. And most of the time it works the same.</p>
<p>The only difference is that <code>||</code> will fall back if the lefthand value is <em>anything</em> falsey. Whereas <code>??</code> will only fall back if the lefthand value is <code>null</code> or <code>undefined</code>. <em>Often</em> this works out the same, but there are some common gotchas, for example, what if our lefthand value is zero or the empty string? Perhaps I wanted to post a blog that has an intentionally blank title? If I were using <code>||</code> this would be impossible. Whereas with <code>??</code>, we can still provide an empty string value, while correctly using a default value in case of <code>undefined</code>.</p>
<p>I highly recommend forgetting about <code>||</code> for default fallbacks and using <code>??</code> instead.</p>
<p>You can enforce this with <a href="https://github.com/typescript-eslint/typescript-eslint">typescript-eslint</a>'s own <a href="https://github.com/typescript-eslint/typescript-eslint/blob/master/packages/eslint-plugin/docs/rules/prefer-nullish-coalescing.md">prefer-nullish-coalescing</a> rule</p>
<h2 id="optional-chaining" tabindex="-1"><a class="direct-link" href="#optional-chaining" aria-hidden="true">#</a> Optional Chaining (?.)</h2>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining">MDN: Optional Chaining</a></p>
<p>What if this time we have a <code>Session</code> object, which has a <code>User</code> only if the current visitor is logged in:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">Session</span> <span class="token punctuation">{</span><br>  user<span class="token operator">?</span><span class="token operator">:</span> User<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">function</span> <span class="token function">getWelcomeMessage</span><span class="token punctuation">(</span>session<span class="token operator">:</span> Session<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> userName <span class="token operator">=</span> session<span class="token punctuation">.</span>user<span class="token operator">?.</span>name<span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>userName <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token string">"Hello Guest!"</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>userName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>This is effectively a shorthand for:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> userName <span class="token operator">=</span> user <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>name<span class="token punctuation">;</span></code></pre>
<p>There is one small difference though, in that the <code>&amp;&amp;</code> style means our <code>userName</code> type will be possibly any falsey value that <code>user</code> could return. Whereas by using <code>?.</code> we can express our intent more concisely, and when the value is not available the whole expression fallbacks to <code>undefined</code>.</p>
<h2 id="all-together" tabindex="-1"><a class="direct-link" href="#all-together" aria-hidden="true">#</a> All together</h2>
<p>We can use all these concepts together:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">Session</span> <span class="token punctuation">{</span><br>  user<span class="token operator">?</span><span class="token operator">:</span> User<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">function</span> <span class="token function">getWelcomeMessage</span><span class="token punctuation">(</span>session<span class="token operator">:</span> Session<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> userName <span class="token operator">=</span> session<span class="token punctuation">.</span>user<span class="token operator">?.</span>name <span class="token operator">??</span> <span class="token string">"GUEST"</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>userName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>This is the same as the previous <code>getWelcomeMessage</code> but even more concise.</p>
<h2 id="summary" tabindex="-1"><a class="direct-link" href="#summary" aria-hidden="true">#</a> Summary</h2>
<ul>
<li>Prefer <code>??</code> to <code>||</code></li>
<li>Prefer <code>foo?.bar</code> to <code>foo &amp;&amp; foo.bar</code></li>
</ul>
<p>Take care,</p>
<p>Rupert</p>

</article>
		<pre aria-hidden="true" class="morse">
█ ███ █
███ ███
		</pre>
	</body>
</html>