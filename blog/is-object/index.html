<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accessing Unknown Objects in TypeScript</title>
    <meta name="description" content="How to solve `Object is of type &#39;unknown&#39;` errors.">
    <link rel="shortcut icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="stylesheet" href="/static/prism.css">
  </head>
  <body>
    <header>
      <h1 class="home">
        <a href="/">Rupert &#39;fildon&#39; McKay</a>
      </h1>
    </header>
    <pre role="img" aria-label="RM">
â–ˆ â–ˆâ–ˆâ–ˆ â–ˆ
â–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆ
    </pre>
    <article>
  <h2>Accessing Unknown Objects in TypeScript</h2>
  <p>There's a utility function I find myself adding to almost every TypeScript repo I work on.</p>
<p>It goes like this:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> isObject <span class="token operator">=</span> <span class="token punctuation">(</span><br>  <span class="token builtin">unknown</span><span class="token operator">:</span> <span class="token builtin">unknown</span><br><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">unknown</span> <span class="token keyword">is</span> Record<span class="token operator">&lt;</span>PropertyKey<span class="token punctuation">,</span> <span class="token builtin">unknown</span><span class="token operator">></span> <span class="token operator">=></span><br>  <span class="token keyword">typeof</span> <span class="token builtin">unknown</span> <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin">unknown</span> <span class="token operator">!==</span> <span class="token keyword">null</span></code></pre>
<h2 id="usecase-in-error-handling" tabindex="-1"><a class="direct-link" href="#usecase-in-error-handling" aria-hidden="true">#</a> Usecase in Error Handling</h2>
<p>Occasionally we have to deal with <code>unknown</code> values. The most common example of this is in <code>catch</code> blocks. Often we want to assume that the caught error is some kind of native <code>Error</code> object, which would have a <code>message</code> property.</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">try</span> <span class="token punctuation">{</span><br>  <span class="token function">somethingDangerous</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// `error` is of `unknown`</span><br>  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><br>  <span class="token comment">// We get a type error on `error.message`</span><br>  <span class="token comment">// because `Object is of type 'unknown'`</span><br><span class="token punctuation">}</span></code></pre>
<blockquote>
<p>Since <a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-4-4.html#using-unknown-in-catch-variables">TypeScript 4.4</a> caught errors are <code>unknown</code> by default.</p>
</blockquote>
<p>But by using our <code>isObject</code> utility, we can narrow the <code>error</code> to something which has keys or not:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">try</span> <span class="token punctuation">{</span><br>  <span class="token function">somethingDangerous</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><br>    <span class="token function">isObject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><br>    <span class="token operator">?</span> error<span class="token punctuation">.</span>message<br>    <span class="token comment">// ðŸ‘† safe access within this branch</span><br>    <span class="token operator">:</span> error<br>    <span class="token comment">// In this case `error` is something different</span><br>    <span class="token comment">// So we'll just log it directly as is.</span><br>  <span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre>
<h2 id="usecase-in-composing-type-predicates" tabindex="-1"><a class="direct-link" href="#usecase-in-composing-type-predicates" aria-hidden="true">#</a> Usecase in Composing Type Predicates</h2>
<p>Learning to create your own type predicates is an important skill in TypeScript. There's a lot you can do by hand, but I will very often use <code>isObject</code> as a starting point for more involved type predicates.</p>
<p>Here's a very simple example:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">type</span> <span class="token class-name">UserApiResponse</span> <span class="token operator">=</span> <span class="token punctuation">{</span><br>  userName<span class="token operator">:</span> <span class="token builtin">string</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">const</span> isUserApiResponse <span class="token operator">=</span> <span class="token punctuation">(</span><br>  userResponse<span class="token operator">:</span> <span class="token builtin">unknown</span><br><span class="token punctuation">)</span><span class="token operator">:</span> userResponse <span class="token keyword">is</span> UserApiResponse <span class="token operator">=></span><br>  <span class="token function">isObject</span><span class="token punctuation">(</span>userResponse<span class="token punctuation">)</span><br>  <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> userResponse<span class="token punctuation">.</span>userName <span class="token operator">===</span> <span class="token string">'string'</span></code></pre>
<p>If we need to go any deeper than one level, this approach becomes very cumbersome; at which point I recommend reaching for a schema validation library such as <a href="https://github.com/colinhacks/zod">Zod</a>.</p>
<p>Here's how the same code above would look with Zod:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> z <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'zod'</span><br><br><span class="token keyword">const</span> UserApiResponse <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  userName<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br><span class="token keyword">type</span> <span class="token class-name">UserApiResponse</span> <span class="token operator">=</span> z<span class="token punctuation">.</span>infer<span class="token operator">&lt;</span><span class="token keyword">typeof</span> UserApiResponse<span class="token operator">></span><br><br><span class="token keyword">const</span> isUserApiResponse <span class="token operator">=</span> <span class="token punctuation">(</span><br>  userResponse<span class="token operator">:</span> <span class="token builtin">unknown</span><br><span class="token punctuation">)</span><span class="token operator">:</span> UserResponse <span class="token keyword">is</span> UserApiResponse <span class="token operator">=></span> <br>  UserApiResponse<span class="token punctuation">.</span><span class="token function">safeParse</span><span class="token punctuation">(</span>userResponse<span class="token punctuation">)</span><span class="token punctuation">.</span>success</code></pre>
<p>That's all for today.</p>
<p>Take care,</p>
<p>Rupert</p>

</article>
  </body>
</html>