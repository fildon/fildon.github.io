<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Publishing TypeScript React components to NPM</title>
		<meta name="description" content="Publishing to NPM can be daunting at first. In this guide we&#39;ll make it quick and easy.">
		<link rel="shortcut icon" type="image/x-icon" href="/static/favicon.ico">
		<link rel="stylesheet" href="/static/styles.css">
		<link rel="stylesheet" href="/static/prism.css">
		<link rel="alternate" type="application/atom+xml" title="Rupert Foggo McKay" href="/feed.xml">
		<meta property="og:description" content="Publishing to NPM can be daunting at first. In this guide we&#39;ll make it quick and easy.">
		<meta property="og:image" content="https://raw.githubusercontent.com/fildon/train-ride/main/train-ride.png">
		<meta property="og:image:type" content="image/png">
		<meta property="og:image:width" content="1280">
		<meta property="og:image:height" content="640">
		<meta name="twitter:card" content="summary_large_image">
		<meta property="twitter:domain" content="rupertmckay.com">
		<meta property="twitter:url" content="https://rupertmckay.com">
		<meta name="twitter:title" content="Publishing TypeScript React components to NPM">
		<meta name="twitter:description" content="Publishing to NPM can be daunting at first. In this guide we&#39;ll make it quick and easy.">
		<meta name="twitter:image" content="https://raw.githubusercontent.com/fildon/train-ride/main/train-ride.png">
	</head>
	<body>
		<header class="horizontal-spread">
			<img src="../../static/headshot.jpeg" alt="Headshot of Rupert" class="rounded wonky" height="64" width="64">
			<h1><a href="/">Rupert McKay</a></h1>
		</header>
		<section class="full-width banner">
			<div>
				<h2>About</h2>
				<p>
					I am Rupert Foggo McKay. I live and work in the Netherlands.
					I work at <a href="https://odido.nl/">Odido.nl</a> as a Principal Software Engineer.
					I write blog posts on esoteric topics from time to time.
				</p>
			</div>
			<address>
				<a href="/blog/">Blog</a>
				<a href="https://github.com/fildon/">GitHub</a>
				<a href="mailto:rupert@rupertmckay.com">Email</a>
			</address>
		</section>
		<article>
	<h1>Publishing TypeScript React components to NPM</h1>
	<date datetime="Sat Jul 17 2021 00:00:00 GMT+0000 (Coordinated Universal Time)">17 Jul 2021</date>
	<p>Key takeaways:</p>
<ul>
<li>compile to a <code>dist</code> directory</li>
<li>copy <code>package.json</code> and <code>README.md</code> files to the <code>dist</code> directory</li>
<li>publish the <code>dist</code> directory</li>
</ul>
<p>If you get stuck or lost at any point during this guide, you can check out my demo repo here: <a href="https://github.com/fildon/typescript-components-by-rupert">TypeScript Components by Rupert</a></p>
<h2 id="project-setup" tabindex="-1"><a class="direct-link" href="#project-setup" aria-hidden="true">#</a> Project setup</h2>
<blockquote>
<p>If you already have a project that you just want to publish, feel free to skip this section, and scroll down to the next heading.</p>
</blockquote>
<p>First, you need a name for your project, which isn't already in use on the npm registry.</p>
<p>For this guide, I'll use <code>typescript-components-by-rupert</code>. There isn't already an npm package with this name, which I can check by going to <a href="https://www.npmjs.com/search?q=typescript-components-by-rupert">https://www.npmjs.com/search?q=typescript-components-by-rupert</a>, and it shows me no exact matches.</p>
<blockquote>
<p>Disclaimer: If you do this search now, you will find an exact match for <code>typescript-components-by-rupert</code>, but it didn't exist before I wrote this guide ðŸ˜€</p>
</blockquote>
<p>Now go to GitHub and <a href="https://github.com/new">create a new repo</a>. Skip any options that add files for you. For this guide, I'll assume you are starting with an empty repository. Then clone it to your machine.</p>
<p>Inside the repo, run the following command to have npm create a <code>package.json</code> for you:</p>
<pre class="language-shell"><code class="language-shell"><span class="token function">npm</span> init <span class="token parameter variable">-y</span></code></pre>
<blockquote>
<p>You'll need to have npm installed globally for this work. If that's not already the case you can find instructions in <a href="https://docs.npmjs.com/cli/v7/configuring-npm/install">the npm docs</a>. For this guide, I am using npm version <code>7.10.0</code>.</p>
</blockquote>
<p>Go ahead and take a look at the <code>package.json</code> it has created. There is a lot to talk about in here, but I'll save that for another post. The only thing you need to confirm right now is that the &quot;name&quot; entry has the name you chose for this project. If it doesn't match for any reason, go ahead and change it now. For example, mine says:</p>
<pre class="language-json"><code class="language-json"><span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"typescript-components-by-rupert"</span><span class="token punctuation">,</span></code></pre>
<p>Next, add <code>TypeScript</code> and <code>React</code> to your project by running:</p>
<pre class="language-shell"><code class="language-shell"><span class="token function">npm</span> <span class="token function">add</span> <span class="token parameter variable">-D</span> typescript react react-dom @types/react</code></pre>
<p>Now that you've added dependencies, you'll see a new <code>node_modules</code> directory has been added. We want <code>git</code> to ignore this directory, so add a <code>.gitignore</code> file with one line inside:</p>
<pre class="language-shell"><code class="language-shell">node_modules</code></pre>
<p>Let's also add a <code>README.md</code>. For now, we can keep this light, but both <code>GitHub</code> and <code>npm</code> recognize this file as special and will render it to HTML as a kind of landing page for our project. It is important to maintain a guide in this file so that people who discover our project can get up to speed quickly.</p>
<p>And now let's write some React! For this guide, I'm going to stick to something very simple, a counter component. I'll create a new directory called <code>src</code> and add the following <code>counter.tsx</code> file:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span>
		<span class="token operator">&lt;</span><span class="token operator">></span>
			<span class="token operator">&lt;</span>p<span class="token operator">></span>You clicked <span class="token punctuation">{</span>count<span class="token punctuation">}</span> times<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
			<span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>Click me<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
		<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<blockquote>
<p>If you would like more guidance on writing React components in TypeScript you can see my post: <a href="https://rupertmckay.com/blog/seeing-through-jsx-to-understand-react-component-types/">Seeing through JSX to understand React component Types</a></p>
</blockquote>
<p>Lets also create an <code>index.ts</code>:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token punctuation">{</span> Counter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./counter"</span><span class="token punctuation">;</span></code></pre>
<p>This might not seem important right now when we only have one component, but if we want this repo to grow, having an index file acts as a kind of point of entry for all our exported components. It also streamlines how our components are imported by projects that depend on this repo, but we'll see that later.</p>
<h2 id="build-process" tabindex="-1"><a class="direct-link" href="#build-process" aria-hidden="true">#</a> Build process</h2>
<p>At this point your file structure should look like this:</p>
<pre class="language-md"><code class="language-md">typescript-components-by-rupert/
â”œâ”€ node_modules/
â”œâ”€ src/
â”‚ â”œâ”€ counter.tsx
â”‚ â””â”€ index.ts
â”œâ”€ .gitignore
â”œâ”€ package-lock.json
â”œâ”€ package.json
â””â”€ README.md</code></pre>
<p>Since we are working with TypeScript we need to use <code>tsc</code> to compile our code. To do that we'll create a <code>tsconfig.json</code> at the root of the project:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
	<span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">"strict"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token property">"jsx"</span><span class="token operator">:</span> <span class="token string">"react"</span><span class="token punctuation">,</span>
		<span class="token property">"declaration"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token property">"esModuleInterop"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token property">"outDir"</span><span class="token operator">:</span> <span class="token string">"dist"</span><span class="token punctuation">,</span>
		<span class="token property">"target"</span><span class="token operator">:</span> <span class="token string">"es6"</span><span class="token punctuation">,</span>
		<span class="token property">"module"</span><span class="token operator">:</span> <span class="token string">"es6"</span><span class="token punctuation">,</span>
		<span class="token property">"moduleResolution"</span><span class="token operator">:</span> <span class="token string">"node"</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token property">"include"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"src"</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre>
<p>I won't dive into what each of these things means, but there are two that I ought to point out right now:</p>
<ul>
<li><code>&quot;declaration&quot;: true</code></li>
<li><code>&quot;outDir&quot;: &quot;dist&quot;</code></li>
</ul>
<p>The <code>declaration</code> option tells tsc whether we want to create <code>.d.ts</code> files while compiling our source code. This isn't always something you want. If you just want to compile TypeScript so that you can run the resulting JavaScript, you don't need this. But since we are intending to publish a library, <code>.d.ts</code> files are important to help provide type safety for projects that depend on our code.</p>
<p>The <code>outDir</code> option tells tsc where to put the files that it builds.</p>
<p>If you want to read up on the other options and tsconfig in general <a href="https://www.typescriptlang.org/tsconfig">here are the tsconfig docs</a></p>
<p>Now that we have a <code>tsconfig.json</code> we can write a build script.</p>
<p>Add this to the <code>scripts</code> section of the <code>package.json</code>:</p>
<pre class="language-json"><code class="language-json"><span class="token property">"clean"</span><span class="token operator">:</span> <span class="token string">"rm -rf dist"</span><span class="token punctuation">,</span>
<span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"npm run clean &amp;&amp; tsc &amp;&amp; cp package.json README.md ./dist"</span><span class="token punctuation">,</span></code></pre>
<p>The <code>clean</code> command will fully delete the <code>dist</code> directory, which is useful for getting a completely new build each time.</p>
<p>The <code>build</code> command, begins by cleaning up any previous build output, then runs <code>tsc</code> (which will automatically use the <code>tsconfig.json</code> we just made), and then finally we copy the <code>package.json</code> and <code>README.md</code> files to the dist directory.</p>
<p>The reason we copy the <code>package.json</code> and <code>README.md</code> files into the dist directory, is that when we get to publishing this project, we want to publish the built files so that people can import and use our code immediately, but the npm CLI only allows publishing a directory that has a <code>package.json</code> in it. This is a common pain point, and I've seen many different approaches to dealing with this, but I think copying over just two files is the smoothest way I've seen to do it. With this approach, we maintain a clear separation between the source code we use for development vs the built code we publish for others to use.</p>
<p>We can now run this command on the terminal with just:</p>
<pre class="language-shell"><code class="language-shell"><span class="token function">npm</span> run build</code></pre>
<p>This will create a 'dist' directory, with all the build output in it. This is another thing we'll want git to ignore. So go ahead and add another line to the <code>.gitignore</code> file, so that it now contains:</p>
<pre class="language-shell"><code class="language-shell">node_modules
dist</code></pre>
<h2 id="publishing" tabindex="-1"><a class="direct-link" href="#publishing" aria-hidden="true">#</a> Publishing</h2>
<p>At this point your file structure should look like this:</p>
<pre class="language-md"><code class="language-md">typescript-components-by-rupert/
â”œâ”€ dist/
â”‚ â”œâ”€ counter.d.ts
â”‚ â”œâ”€ counter.js
â”‚ â”œâ”€ index.d.ts
â”‚ â”œâ”€ index.js
â”‚ â”œâ”€ package.json
â”‚ â””â”€ README.md
â”œâ”€ node_modules/
â”œâ”€ src/
â”‚ â”œâ”€ counter.tsx
â”‚ â””â”€ index.ts
â”œâ”€ .gitignore
â”œâ”€ tsconfig.json
â”œâ”€ package-lock.json
â”œâ”€ package.json
â””â”€ README.md</code></pre>
<p>We now have some lovely source code and a painless build process. But we haven't published anything yet!</p>
<blockquote>
<p>You'll need an npm account for the next part, so if you don't already have one, head over here: <a href="https://docs.npmjs.com/creating-a-new-npm-user-account">Creating a new npm user account</a></p>
</blockquote>
<p>Once you have an account, you can log in on the terminal by running the following command and then enter your username and password when prompted:</p>
<pre class="language-shell"><code class="language-shell"><span class="token function">npm</span> login</code></pre>
<p>Now we are ready to publish. This is your last chance to double-check that everything is the way you want it. <em>Once a version is published it can never be changed</em>. When you are ready:</p>
<pre class="language-shell"><code class="language-shell"><span class="token function">npm</span> publish ./dist</code></pre>
<p>ðŸŽ‰ Hooray, you did it! ðŸŽŠ</p>
<h2 id="checking-it-works" tabindex="-1"><a class="direct-link" href="#checking-it-works" aria-hidden="true">#</a> Checking it works</h2>
<p>Ok, but did it work? ðŸ˜…</p>
<p>We can check quickly by going to the npm page for your package. For me that is at <a href="https://www.npmjs.com/package/typescript-components-by-rupert">https://www.npmjs.com/package/typescript-components-by-rupert</a>. Just change the last part of the URL to your package name to see if it is there already.</p>
<p>The ultimate test though is importing your package into another repository. If you have one available you should be able to run:</p>
<pre class="language-shell"><code class="language-shell"><span class="token function">npm</span> <span class="token function">add</span> typescript-components-by-rupert</code></pre>
<p>And then in any JS or TS file import your component:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> Counter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"typescript-components-by-rupert"</span><span class="token punctuation">;</span></code></pre>
<h2 id="the-future" tabindex="-1"><a class="direct-link" href="#the-future" aria-hidden="true">#</a> The Future</h2>
<p>This is just the start. Now that you have a build and publishing process, you can go ahead and add all sorts of new components and features to your library. Each time you want to publish your new work, you need to do so as a new version. The current version is listed in your <code>package.json</code>. Ideally, you should stick to <a href="https://semver.org/">semantic versioning</a>, although not everyone does. TypeScript for example doesn't use semantic versioning!</p>
<p>If you are looking for inspiration on what to add next, I highly recommend each and all of the following:</p>
<ul>
<li><a href="https://jestjs.io/">Jest</a> for unit testing</li>
<li><a href="https://testing-library.com/docs/react-testing-library/intro">React Testing Library</a> to make testing components easy</li>
<li><a href="https://eslint.org/">ESLint</a> for linting</li>
<li><a href="https://storybook.js.org/">Storybook</a> for running components in isolation</li>
</ul>
<h2 id="summary" tabindex="-1"><a class="direct-link" href="#summary" aria-hidden="true">#</a> Summary</h2>
<ul>
<li>compile to a <code>dist</code> directory</li>
<li>copy over <code>package.json</code> and <code>README.md</code> files to the <code>dist</code> directory</li>
<li>publish the <code>dist</code> directory</li>
</ul>
<p>Take care,</p>
<p>Rupert</p>

</article>
	</body>
</html>
